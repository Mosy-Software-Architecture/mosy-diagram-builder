# Flow Specifications Template

## Instructions for AI Assistants

When creating flow specifications, You MUST follow these rules:

### Required Format
- You MUST use the standardized table format with columns: Aspect | Step 1 | Step 2 | ...
- You MUST include these rows in exact order:
  - **Actor**: The actor performing the action (UserActor, SystemActor, CustomerActor, etc.)
  - **Action**: The action being executed (CreateTaskAction, BrowseProductsAction, etc.)
  - **Entities**: Entities involved with [read-only] or [write] access specified
  - **Metrics**: Metrics captured by this step (use "-" if none)
  - **Technical components and APIs**: Controllers, frontend components, API endpoints
  - **Produced events**: Events generated by this step (use "-" if none)
  - **Triggered by**: What initiates this step (user interaction, API call, event, etc.)

### Naming Conventions
- You MUST name actors with "Actor" suffix: UserActor, SystemActor, CustomerActor
- You MUST name actions with "Action" suffix: CreateTaskAction, BrowseProductsAction
- You MUST specify entity access as [read-only] or [write] for each entity
- You MUST NOT create backend Service classes - use Actions for business logic

### Flow Rules
- You MUST keep each flow as an end-to-end business operation spanning potentially multiple actions triggered by other actions and events
- You MUST NOT add technical metrics unless user explicitly requests them
- You MUST show event production in the "Produced events" row
- You MUST follow the Actor→Action→Entity pattern strictly
- You MUST separate frontend technical components from backend technical components

## Example 1: Create New Task Flow (Basic)

**Description**: User creates a new task by providing a description. The system stores the task with an automatically generated ID and creation timestamp.

| Aspect | Step 1 | Step 2 |
|--------|--------|--------|
| **Actor** | UserActor | SystemActor |
| **Action** | SubmitTaskCreationAction | StoreTaskAction |
| **Entities** | Task [write] | Task [write] |
| **Metrics** | - | tasksCreated |
| **Technical components and APIs** | CreateTaskForm, TaskFormInput, TaskService (frontend), POST /api/tasks | TaskController, CreateTaskAction, TaskRepository |
| **Produced events** | - | - |
| **Triggered by** | User interaction (form submit) | API call from frontend |

### Flow Details

**Step 1: SubmitTaskCreationAction**
- User fills in task description in the CreateTaskForm component
- TaskFormInput component validates that description is not empty
- CreateTaskForm handles form submission
- TaskService sends POST request to `/api/tasks` with task description

**Step 2: StoreTaskAction**
- TaskController receives the task creation request
- CreateTaskAction validates description (required, max 500 characters)
- Creates Task entity with:
  - Auto-generated ID
  - Provided description
  - Current timestamp as createdAt
  - Status set to TODO
- TaskRepository persists task to database
- Returns created task with 201 Created status

## Example 2: Browse Products Flow (E-Commerce)

**Description**: Customer views available products in the catalog.

| Aspect | Step 1 |
|--------|--------|
| **Actor** | CustomerActor |
| **Action** | BrowseProductsAction |
| **Entities** | Product [read-only] |
| **Metrics** | productsViewed |
| **Technical components and APIs** | ProductPage, ProductService (frontend), GET /api/products, ProductController, BrowseProductsAction, ProductRepository |
| **Produced events** | - |
| **Triggered by** | User navigates to products page |

### Flow Details

**Step 1: BrowseProductsAction**
- Customer navigates to product catalog page
- ProductPage component loads and requests product data
- ProductService (frontend) sends GET request to `/api/products`
- ProductController receives request and creates CustomerActor
- BrowseProductsAction executes with actor context
- ProductRepository retrieves active products from database
- Returns product list with 200 OK status

## Example 3: Add to Cart Flow (Multi-Step)

**Description**: Customer adds a product to their shopping cart with inventory validation.

| Aspect | Step 1 | Step 2 |
|--------|--------|--------|
| **Actor** | CustomerActor | SystemActor |
| **Action** | AddToCartAction | ValidateInventoryAction |
| **Entities** | Product [read-only], Cart [write], CartLine [write] | Product [read-only], Inventory [read-only] |
| **Metrics** | itemsAddedToCart | inventoryValidations |
| **Technical components and APIs** | CartPage, CartService (frontend), POST /api/cart/add, CartController, AddToCartAction | EventHandler (inventory-validator), ValidateInventoryAction |
| **Produced events** | CartUpdatedEvent | InventoryValidatedEvent |
| **Triggered by** | User clicks "Add to Cart" | CartUpdatedEvent |

### Flow Details

**Step 1: AddToCartAction**
- Customer clicks "Add to Cart" button with quantity
- CartService (frontend) sends POST to `/api/cart/add`
- CartController creates CustomerActor and AddToCartAction
- Action validates product exists and is available
- Creates or updates CartLine entity with product and quantity
- Updates Cart entity with new total
- Publishes CartUpdatedEvent for async processing
- Returns updated cart with 200 OK

**Step 2: ValidateInventoryAction**
- EventHandler receives CartUpdatedEvent
- Creates SystemActor for system-initiated processing
- ValidateInventoryAction checks current inventory levels
- Validates quantity is available
- Publishes InventoryValidatedEvent with validation result
- If invalid, triggers compensation flow (not shown)

## Example 4: Process Payment Flow (Event-Driven)

**Description**: Processes customer payment and completes the order with multiple system actions.

| Aspect | Step 1 | Step 2 | Step 3 |
|--------|--------|--------|--------|
| **Actor** | CustomerActor | SystemActor | SystemActor |
| **Action** | ProcessPaymentAction | UpdateInventoryAction | CompleteOrderAction |
| **Entities** | Payment [write], Order [read-only] | Product [write], Inventory [write] | Order [write] |
| **Metrics** | paymentsProcessed, failedPayments | inventoryUpdates | completedOrders |
| **Technical components and APIs** | CheckoutPage, PaymentService (frontend), POST /api/payment/process, PaymentController, ProcessPaymentAction | EventHandler (inventory-updater), UpdateInventoryAction | EventHandler (order-completer), CompleteOrderAction |
| **Produced events** | PaymentProcessedEvent | InventoryUpdatedEvent | OrderCompletedEvent |
| **Triggered by** | User submits payment | PaymentProcessedEvent | InventoryUpdatedEvent |

### Flow Details

**Step 1: ProcessPaymentAction**
- Customer submits payment information
- PaymentController creates CustomerActor
- ProcessPaymentAction validates payment details
- Processes payment through payment gateway
- Creates Payment entity with transaction details
- Publishes PaymentProcessedEvent on success
- Returns payment confirmation

**Step 2: UpdateInventoryAction**
- Triggered by PaymentProcessedEvent
- SystemActor handles inventory updates
- Reduces inventory quantities for purchased items
- Updates Product stock levels
- Publishes InventoryUpdatedEvent

**Step 3: CompleteOrderAction**
- Triggered by InventoryUpdatedEvent
- SystemActor finalizes the order
- Updates Order status to COMPLETED
- Generates order confirmation
- Publishes OrderCompletedEvent for notifications

## Metrics Reference

For detailed specifications of metrics mentioned in these flows, see the Metrics Specifications Template:
`agentguild://resources/ai-kb/mosy/spec-templates/metrics-specs.md`

Common flow metrics include:
- tasksCreated, tasksCompleted (Task Management)
- productsViewed, itemsAddedToCart (E-Commerce)
- paymentsProcessed, completedOrders (Order Processing)

---

© 2025 Mosy Software Architecture SL. All rights reserved.

Licensed to AgentGuild customers for internal use only. Distribution, copying, or derivative works prohibited without written permission. Contact: legal@mosy.tech